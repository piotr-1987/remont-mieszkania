<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Remont Mieszkania 56 – Sielskie Podolany</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 2rem; background: #f8f9fa; }
    h1 { color: #333; }
    table, th, td { border: 1px solid #ccc; border-collapse: collapse; padding: 0.5rem; }
    table { width: 100%; margin-bottom: 1rem; background: #fff; }
    th { background-color: #eee; }
    input, select, button { margin: 0.25rem; padding: 0.5rem; }
    .filter-group { margin-bottom: 1rem; }
  </style>
</head>
<body>
  <h1>Remont mieszkania 56 – Osiedle Sielskie Podolany</h1>

  <div class="filter-group">
    <label>Filtruj po dacie: <input type="date" id="filterDate" /></label>
    <label>Po pomieszczeniu:
      <select id="filterRoom">
        <option value="">Wszystkie</option>
        <option value="Aneks kuchenny">Aneks kuchenny</option>
        <option value="Łazienka">Łazienka</option>
        <option value="Sypialnia">Sypialnia</option>
        <option value="Ogród">Ogród</option>
      </select>
    </label>
    <label>Po nazwie produktu: <input type="text" id="filterProduct" /></label>
    <button onclick="applyFilters()">Zastosuj filtry</button>
  </div>

  <table id="expensesTable">
    <thead>
      <tr>
        <th>Data</th>
        <th>Kwota (zł)</th>
        <th>Typ</th>
        <th>Nazwa produktu</th>
        <th>Model</th>
        <th>Pomieszczenie</th>
        <th>Kategoria</th>
        <th>Nr dokumentu</th>
        <th>Akcje</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <form onsubmit="addExpense(event)">
    <input type="date" id="date" required />
    <input type="number" id="amount" placeholder="Kwota" required />
    <input type="text" id="type" placeholder="Typ" required />
    <input type="text" id="name" placeholder="Nazwa produktu" required />
    <input type="text" id="model" placeholder="Model" required />
    <select id="room" required>
      <option value="">Pomieszczenie</option>
      <option value="Aneks kuchenny">Aneks kuchenny</option>
      <option value="Łazienka">Łazienka</option>
      <option value="Sypialnia">Sypialnia</option>
      <option value="Ogród">Ogród</option>
    </select>
    <select id="category" required>
      <option value="">Kategoria</option>
      <option value="Wyposażenie/Sprzęt">Wyposażenie/Sprzęt</option>
      <option value="Materiał budowlany/Robocizna">Materiał budowlany/Robocizna</option>
    </select>
    <input type="text" id="docNumber" placeholder="Nr dokumentu/paragonu" required />
    <button type="submit">Dodaj wydatek</button>
  </form>

  <canvas id="chart" height="100"></canvas>

  <div>
    <button onclick="exportToExcel()">Eksport do Excel</button>
    <button onclick="exportToPDF()">Eksport do PDF</button>
  </div>

  <script>
    const expenses = [];

    function addExpense(event) {
      event.preventDefault();
      const expense = {
        date: date.value,
        amount: parseFloat(amount.value),
        type: type.value,
        name: name.value,
        model: model.value,
        room: room.value,
        category: category.value,
        docNumber: docNumber.value
      };
      expenses.push(expense);
      renderTable();
    }

    function renderTable(filtered = expenses) {
      const tbody = document.querySelector("#expensesTable tbody");
      tbody.innerHTML = "";
      filtered.forEach((e, index) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${e.date}</td>
          <td>${e.amount.toFixed(2)}</td>
          <td>${e.type}</td>
          <td>${e.name}</td>
          <td>${e.model}</td>
          <td>${e.room}</td>
          <td>${e.category}</td>
          <td>${e.docNumber}</td>
          <td>
            <button onclick="editExpense(${index})">Edytuj</button>
            <button onclick="deleteExpense(${index})">Usuń</button>
          </td>`;
        tbody.appendChild(tr);
      });
    }

    function deleteExpense(index) {
      if (confirm("Czy na pewno usunąć ten wpis?")) {
        expenses.splice(index, 1);
        renderTable();
      }
    }

    function editExpense(index) {
      const e = expenses[index];
      date.value = e.date;
      amount.value = e.amount;
      type.value = e.type;
      name.value = e.name;
      model.value = e.model;
      room.value = e.room;
      category.value = e.category;
      docNumber.value = e.docNumber;
      expenses.splice(index, 1);
      renderTable();
    }

    function applyFilters() {
      const dateF = document.getElementById("filterDate").value;
      const roomF = document.getElementById("filterRoom").value;
      const productF = document.getElementById("filterProduct").value.toLowerCase();
      const filtered = expenses.filter(e => {
        return (!dateF || e.date === dateF)
          && (!roomF || e.room === roomF)
          && (!productF || e.name.toLowerCase().includes(productF));
      });
      renderTable(filtered);
    }

    function exportToExcel() {
      const ws = XLSX.utils.json_to_sheet(expenses);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "Wydatki");
      XLSX.writeFile(wb, "wydatki_mieszkanie56.xlsx");
    }

    function exportToPDF() {
      window.print(); // Prosty eksport – możesz podmienić na html2pdf.js
    }
  </script>
</body>
</html>
